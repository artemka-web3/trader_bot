<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://widget.cloudpayments.ru/bundles/cloudpayments.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <title>Оплата подписки на пол года</title>
  </head>
  <body>
    <div class="container py-5">
      <div class="row">
        <div class="col-lg-4 mx-auto">

          <div class="card">
            <div class="card-body text-center">
              <h4 class="card-title font-weight-bold">Оплата подписки на пол года</h4>
              <p class="card-text">Перед тем как нажать на кнопку ниже, убедитесь что вы прочитали все руководства по испльзованию бота и пользовательское соглашение. После оплаты вас перекинет обратно в бота!</p>
              <button id="checkout" class="btn btn-primary mt-3">Оплатить</button>
            </div>
          </div> 

        </div>
      </div>
    </div>

    <script>
        document.getElementById('checkout').onclick = function () {
            var payments = new cp.CloudPayments({
                yandexPaySupport: false,
                applePaySupport: false,
                googlePaySupport: false,
                masterPassSupport: false,
                tinkoffInstallmentSupport: false
            });
    
            payments.oncomplete = (result) => {
                console.log('result', result);
                window.location.href = "/getTokenSemiYear/" + "<%= account_id %>" + '/' +(result.data.transactionId).toString();
            }
    
            var receipt = {
                Items: [//товарные позиции
                    {
                        label: 'Оплата подписки на пол года', //наименование товара
                        price: 10.00, //цена
                        quantity: 0.00, //количество
                        amount: 10.00, //сумма
                        vat: 20, //ставка НДС
                        method: 0, // тег-1214 признак способа расчета - признак способа расчета
                        object: 0, // тег-1212 признак предмета расчета - признак предмета товара, работы, услуги, платежа, выплаты, иного предмета расчета
                    }
                ],
                taxationSystem: 0, //система налогообложения; необязательный, если у вас одна система налогообложения
                email: 'user@example.com', //e-mail покупателя, если нужно отправить письмо с чеком
                phone: '', //телефон покупателя в любом формате, если нужно отправить сообщение со ссылкой на чек
                isBso: false, //чек является бланком строгой отчетности
                amounts: {
                    electronic: 10.00, // Сумма оплаты электронными деньгами
                    advancePayment: 0.00, // Сумма из предоплаты (зачетом аванса) (2 знака после запятой)
                    credit: 0.00, // Сумма постоплатой(в кредит) (2 знака после запятой)
                    provision: 0.00 // Сумма оплаты встречным предоставлением (сертификаты, др. мат.ценности) (2 знака после запятой)
                }
            };
    
            var data = { //содержимое элемента data
                CloudPayments: {
                    CustomerReceipt: receipt, //чек для первого платежа
                    recurrent: {
                                interval: 'Year', // изменение на полугодовой интервал
                                period: 2,
                                customerReceipt: receipt //чек для регулярных платежей
                    }
                }
            };
            
            payments.pay("charge", { // options
                publicId: 'pk_c8695290fec5bcb40f468cca846d2',
                accountId: '<%= account_id %>',
                description: 'Оплата подписки на пол года',
                amount: 10,
                currency: 'RUB',
                data: data
            }).then((result) => {
                // Объект типа WidgetResult
                console.log('result', result);
            });
    
               
           };
      </script>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
</html>

